# Configuración básica de Caddy para la aplicación Laravel
:2019 {
    # Directorio raíz de la aplicación
    root * /var/www/html/public

    # Configuración de PHP
    php_fastcgi 127.0.0.1:9000 {
        # Aumenta el tiempo de espera para scripts largos
        dial_timeout 5s
        read_timeout 300s
        write_timeout 300s
    }

    # Intentar archivos y directorios, redirigir a index.php
    try_files {path} {path}/ /index.php?{query}

    # Manejo de archivos estáticos
    @static {
        path *.ico *.css *.js *.gif *.jpg *.jpeg *.png *.svg *.webp *.woff *.woff2 *.ttf *.eot
    }
    
    # Configuración de caché para archivos estáticos
    header @static Cache-Control "public, max-age=31536000, immutable"
    
    # Configuración de logs
    log {
        output file /var/log/caddy/access.log
        format json
    }

    # Compresión Gzip
    encode gzip
    
    # Deniega acceso a archivos ocultos
    @hidden path */\.*
    respond @hidden 404
}

# Para administrar Caddy
:2020 {
    # Solo permitir conexiones locales
    @localnet remote_ip 127.0.0.1 ::1
    
    # API de Caddy
    handle @localnet {
        respond "Caddy Admin API"
    }
    
    # Rechazar otros accesos
    handle {
        respond 403
    }
}